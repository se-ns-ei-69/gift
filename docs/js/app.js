(()=>{const e=document.getElementById("audio"),t=document.getElementById("play-pause-btn"),n=document.getElementById("progress"),a=document.getElementById("current-time"),i=document.getElementById("duration"),o=document.getElementById("play-icon"),s=document.getElementById("vinyl__image"),c=document.getElementById("tone_arm__image"),d=document.getElementById("tone_arm__image_inner"),l=document.getElementById("song-list"),r=document.getElementById("file-input"),m=document.getElementById("song-title"),u=document.getElementById("song-artist"),g=document.getElementById("volume"),y=document.getElementById("visualizer"),v=y.getContext("2d");y.width=window.innerWidth,y.height=window.innerHeight;let E,p,L,f,h=0,I=[];function w(){if(!L)return;v.clearRect(0,0,y.width,y.height),E.getByteFrequencyData(f);const t=y.width/p;for(let e=0;e<p;e++){const n=f[e];v.fillStyle=`rgb(${n+100}, 50, 150)`,v.fillRect(e*t,y.height-n,t,n)}e.paused||requestAnimationFrame(w)}function B(t,n){console.log("isPlaying",C),h=n;const a=document.querySelectorAll(".song-item");a.forEach((e=>e.classList.remove("active"))),a[n].classList.add("active"),window.jsmediatags.read(t,{onSuccess:function(n){const{title:a,artist:i,picture:o}=n.tags;m.textContent=a||"Untitled",u.textContent=i||"Unknown Artist",e.src=URL.createObjectURL(t),e.play(),C=!C},onError:function(e){console.error("Error reading tags:",e)}})}r.addEventListener("change",(async e=>{console.log("change");const t=e.target.files;I=Array.from(t),I.forEach(((e,t)=>{const n=document.createElement("div");n.classList.add("song-item"),n.textContent=e.name,n.addEventListener("click",(()=>B(e,t))),l.appendChild(n)})),I.length>0&&B(I[0],0)})),e.addEventListener("play",(t=>{L||(L=new(window.AudioContext||window.webkitAudioContext),E=L.createAnalyser(),L.createMediaElementSource(e).connect(E),E.connect(L.destination),E.fftSize=256,p=E.frequencyBinCount,f=new Uint8Array(p)),w(),o.src="img/pause.svg",o.alt="Play Icon",c.classList.add("active"),d.classList.add("active"),s.classList.add("playing")})),e.addEventListener("pause",(e=>{o.src="img/play.svg",o.alt="Play Icon",s.classList.remove("playing"),c.classList.remove("active"),d.classList.remove("active")}));let C=!1;function x(e){return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}t.addEventListener("click",(()=>{C?(e.pause(),o.src="img/play.svg",o.alt="Play Icon",s.classList.remove("playing"),c.classList.remove("active"),d.classList.remove("active")):(e.play(),o.src="img/pause.svg",o.alt="Play Icon",c.classList.add("active"),d.classList.add("active"),s.classList.add("playing")),C=!C})),e.addEventListener("timeupdate",(()=>{const t=e.currentTime,o=e.duration;n.value=t/o*100,a.textContent=x(t),i.textContent=x(o)})),n.addEventListener("input",(t=>{const n=e.duration;e.currentTime=t.target.value/100*n})),g.addEventListener("input",(t=>{e.volume=t.target.value})),e.addEventListener("loadedmetadata",(()=>{i.textContent=x(e.duration)}))})();